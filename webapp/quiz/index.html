<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vimly — Квиз‑заявка</title>
  <link rel="stylesheet" href="./style.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Vimly</h1>
      <p>Квиз‑заявка (WebApp)</p>
    </header>

    <form id="quiz">
      <label>Описание компании</label>
      <textarea id="company" placeholder="Кто вы, ниша и город..." rows="4" required></textarea>

      <label>Задание — что нужно сделать</label>
      <textarea id="task" placeholder="Какая задача у бота? заявки/запись/оплата/отзывы..." rows="5" required></textarea>

      <label>Контакты в Telegram</label>
      <input id="contact" type="text" placeholder="@username или номер" required />

      <button type="submit" id="send">Отправить заявку</button>
      <p class="hint">Нажимая «Отправить», вы отправляете данные напрямую в бот.</p>
    </form>

    <footer>
      <small>© Vimly</small>
    </footer>
  </div>

  <script>
(function(){
  const tg = window.Telegram && Telegram.WebApp ? Telegram.WebApp : null;
  const btn = document.getElementById('send');
  async function send(){
    const payload = {
      company: document.getElementById('company').value||"",
      task: document.getElementById('task').value||"",
      contact: document.getElementById('contact').value||""
    };
    if (tg && tg.sendData){
      tg.sendData(JSON.stringify(payload));
      tg.close();
    } else {
      // Fallback: отправим напрямую на сервер
      try{
        await fetch('/webapp/submit', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
        alert('Заявка отправлена. Спасибо!');
      }catch(e){
        alert('Не удалось отправить заявку: '+e);
      }
    }
  }
  if (tg){ tg.expand(); tg.ready(); }
  btn.addEventListener('click', send);
})();
</script>

</body>
</html>
